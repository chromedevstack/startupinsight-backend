<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StartupInsight AI - Advanced Market Intelligence Platform</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
/* CSS styles here */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --secondary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    --warning-gradient: linear-gradient(135deg, #ffc107 0%, #ff8a00 100%);
    --danger-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    --glass-bg: rgba(255, 255, 255, 0.1);
    --glass-border: rgba(255, 255, 255, 0.2);
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--primary-gradient);
    min-height: 100vh;
    color: #333;
    overflow-x: hidden;
}

.animated-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--primary-gradient);
    z-index: -1;
}

.animated-bg::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
    animation: float 20s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(2deg); }
}

.container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
}

.header {
    text-align: center;
    margin-bottom: 50px;
    color: white;
    position: relative;
}

.header h1 {
    font-size: 4rem;
    font-weight: 900;
    margin-bottom: 15px;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
    background: linear-gradient(45deg, #fff, #e2e8f0);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.header p {
    font-size: 1.4rem;
    opacity: 0.95;
    margin-bottom: 20px;
}

.ai-badges {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
    margin-top: 20px;
}

.ai-badge {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    color: white;
    padding: 10px 20px;
    border-radius: 30px;
    font-size: 0.9rem;
    font-weight: 600;
    animation: pulse 3s infinite;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
}

.main-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    padding: 50px;
    box-shadow: 0 25px 80px rgba(0,0,0,0.15);
    border: 1px solid var(--glass-border);
    position: relative;
    overflow: hidden;
}

.main-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--secondary-gradient);
}

.input-section {
    margin-bottom: 50px;
    position: relative;
}

.advanced-inputs {
    display: grid;
    gap: 25px;
}

.input-row {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr auto;
    gap: 20px;
    align-items: end;
}

.secondary-inputs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
    position: relative;
}

.form-group label {
    font-weight: 700;
    margin-bottom: 10px;
    color: white;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

input, select, textarea {
    padding: 16px 20px;
    border: 2px solid var(--glass-border);
    border-radius: 15px;
    font-size: 16px;
    transition: all 0.4s ease;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    color: #333;
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #00f2fe;
    box-shadow: 0 0 0 4px rgba(0, 242, 254, 0.1);
    transform: translateY(-2px);
}

textarea {
    resize: vertical;
    min-height: 100px;
    font-family: inherit;
}

.analyze-btn {
    background: var(--secondary-gradient);
    color: white;
    border: none;
    padding: 18px 35px;
    border-radius: 15px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.4s ease;
    box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;
    overflow: hidden;
}

.analyze-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.analyze-btn:hover::before {
    left: 100%;
}

.analyze-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(79, 172, 254, 0.4);
}

.analyze-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.results-container {
    margin-top: 50px;
}

.results-header {
    text-align: center;
    margin-bottom: 40px;
    color: white;
}

.results-header h2 {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 10px;
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
}

.result-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.result-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--secondary-gradient);
    transform: scaleX(0);
    transition: transform 0.4s ease;
}

.result-card:hover::before {
    transform: scaleX(1);
}

.result-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.15);
}

.result-card h3 {
    color: #2d3748;
    margin-bottom: 20px;
    font-size: 1.4rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 10px;
}

.metric-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.metric-card {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.metric-card:hover {
    border-color: #4facfe;
    transform: scale(1.05);
}

.metric-value {
    font-size: 2rem;
    font-weight: 900;
    color: #667eea;
    display: block;
}

.metric-label {
    font-size: 0.85rem;
    color: #64748b;
    margin-top: 5px;
    font-weight: 600;
}

.budget-selector {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin: 25px 0;
}

.budget-card {
    background: white;
    padding: 25px;
    border-radius: 15px;
    border: 3px solid #e2e8f0;
    text-align: center;
    transition: all 0.4s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.budget-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--secondary-gradient);
    opacity: 0;
    transition: opacity 0.4s ease;
}

.budget-card:hover {
    border-color: #4facfe;
    box-shadow: 0 10px 30px rgba(79, 172, 254, 0.2);
    transform: translateY(-5px);
}

.budget-card.selected {
    border-color: #4facfe;
    background: var(--secondary-gradient);
    color: white;
    transform: translateY(-5px);
}

.budget-card.selected::before {
    opacity: 1;
}

.budget-card h4, .budget-card p {
    position: relative;
    z-index: 1;
}

.ai-insight {
    background: var(--secondary-gradient);
    color: white;
    padding: 25px;
    border-radius: 15px;
    margin: 25px 0;
    position: relative;
    overflow: hidden;
}

.ai-insight::before {
    content: '';
    position: absolute;
    top: -12px;
    left: 25px;
    background: white;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.loading {
    display: none;
    text-align: center;
    padding: 60px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.loading.active {
    display: block;
}

.spinner {
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #00f2fe;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
    margin: 0 auto 30px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.analysis-progress {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    margin: 25px 0;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.progress-step {
    display: flex;
    align-items: center;
    gap: 15px;
    margin: 12px 0;
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.7);
    transition: all 0.4s ease;
}

.progress-step.active {
    color: #00f2fe;
    font-weight: 700;
}

.progress-step.completed {
    color: #38ef7d;
    font-weight: 600;
}

.web-sources {
    background: rgba(240, 249, 255, 0.9);
    border: 1px solid #0ea5e9;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

.web-sources h4 {
    color: #0369a1;
    margin-bottom: 15px;
    font-size: 1.1rem;
    font-weight: 700;
}

.source-links {
    display: grid;
    gap: 8px;
}

.source-link {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #0369a1;
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-size: 0.95rem;
}

.source-link:hover {
    background: rgba(3, 105, 161, 0.1);
    transform: translateX(5px);
}

.source-link::before {
    content: '';
    font-size: 14px;
}

.trend-indicator {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.trend-up {
    background: linear-gradient(135deg, #dcfce7, #bbf7d0);
    color: #166534;
}

.trend-down {
    background: linear-gradient(135deg, #fef2f2, #fecaca);
    color: #dc2626;
}

.trend-stable {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    color: #92400e;
}

.rating-display {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    margin: 15px 0;
    padding: 15px;
    background: rgba(248, 250, 252, 0.8);
    border-radius: 10px;
    transition: all 0.3s ease;
}

.rating-display:hover {
    background: rgba(248, 250, 252, 1);
    transform: translateX(5px);
}

.stars {
    display: flex;
    gap: 3px;
}

.star {
    width: 22px;
    height: 22px;
    background: #ffd700;
    clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
    transition: all 0.3s ease;
}

.star.empty {
    background: #e2e8f0;
}

.star:hover {
    transform: scale(1.2);
}

.chart-container {
    margin: 25px 0;
    height: 350px;
    position: relative;
    background: white;
    border-radius: 12px;
    padding: 15px;
}

.timeline {
    position: relative;
    padding-left: 40px;
    margin: 25px 0;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 15px;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--secondary-gradient);
    border-radius: 2px;
}

.timeline-item {
    position: relative;
    margin-bottom: 25px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.timeline-item::before {
    content: '';
    position: absolute;
    left: -32px;
    top: 20px;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: var(--secondary-gradient);
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.timeline-item:hover {
    transform: translateX(10px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.error-message {
    background: var(--danger-gradient);
    color: white;
    padding: 20px;
    border-radius: 12px;
    margin: 20px 0;
    border-left: 4px solid #dc2626;
    font-weight: 600;
}

.competition-item {
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin: 15px 0;
    border-left: 4px solid #4facfe;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.competition-item:hover {
    transform: translateX(8px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.live-indicator {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--success-gradient);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
    animation: pulse 2s infinite;
}

.live-indicator::before {
    content: '●';
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0.3; }
}

@media (max-width: 1024px) {
    .input-row {
        grid-template-columns: 1fr;
    }

    .budget-selector {
        grid-template-columns: 1fr;
    }

    .header h1 {
        font-size: 3rem;
    }

    .results-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .ai-badges {
        flex-direction: column;
        align-items: center;
    }

    .main-card {
        padding: 30px 20px;
    }

    .header h1 {
        font-size: 2.5rem;
    }
}
</style>
</head>
<body>
<div class="animated-bg"></div>

<div class="container">
<div class="header">
<h1>StartupInsight AI</h1>
<p>Advanced Real-Time Market Intelligence & Strategic Analysis Platform</p>
<div class="ai-badges">
<div class="ai-badge">Live Web Scanning</div>
<div class="ai-badge">Real-Time Market Data</div>
<div class="ai-badge">AI-Powered Analysis</div>
<div class="ai-badge">Future Trend Prediction</div>
</div>
</div>

<div class="main-card">
<div class="input-section">
<div class="advanced-inputs">
<div class="input-row">
<div class="form-group">
<label for="startupIdea">Startup Concept & Vision</label>
<textarea id="startupIdea" placeholder="Describe your startup idea in comprehensive detail... Include your target market, unique value proposition, problem you're solving, and your proposed solution. The more specific you are, the more accurate our AI analysis will be."></textarea>
</div>
<div class="form-group">
<label for="industry">Primary Industry</label>
<select id="industry">
<option value="">Select Industry</option>
<option value="technology">Technology & Software</option>
<option value="healthcare">Healthcare & Biotech</option>
<option value="fintech">Financial Technology</option>
<option value="ecommerce">E-commerce & Retail</option>
<option value="saas">Software as a Service</option>
<option value="ai-ml">AI & Machine Learning</option>
<option value="blockchain">Blockchain & Crypto</option>
<option value="edtech">Education Technology</option>
<option value="foodtech">Food & Beverage Tech</option>
<option value="cleantech">Clean Technology</option>
<option value="gaming">Gaming & Entertainment</option>
<option value="proptech">Property Technology</option>
<option value="mobility">Transportation & Mobility</option>
<option value="iot">Internet of Things</option>
<option value="cybersecurity">Cybersecurity</option>
<option value="other">Other</option>
</select>
</div>
<div class="form-group">
<label for="stage">Current Stage</label>
<select id="stage">
<option value="">Select Stage</option>
<option value="ideation">Ideation</option>
<option value="validation">Market Validation</option>
<option value="mvp">MVP Development</option>
<option value="early-stage">Early Stage</option>
<option value="growth">Growth Stage</option>
<option value="scaling">Scaling</option>
</select>
</div>
<div class="form-group">
<label>&nbsp;</label>
<button class="analyze-btn" onclick="analyzeStartup()" id="analyzeBtn">
AI Analyze
</button>
</div>
</div>

<div class="secondary-inputs">
<div class="form-group">
<label for="targetMarket">Target Market</label>
<input type="text" id="targetMarket" placeholder="e.g., Small businesses, Gen Z consumers">
</div>
<div class="form-group">
<label for="geography">Primary Geography</label>
<select id="geography">
<option value="global">Global</option>
<option value="north-america">North America</option>
<option value="europe">Europe</option>
<option value="asia-pacific">Asia Pacific</option>
<option value="latin-america">Latin America</option>
<option value="middle-east">Middle East</option>
<option value="africa">Africa</option>
</select>
</div>
<div class="form-group">
<label for="businessModel">Business Model</label>
<select id="businessModel">
<option value="">Select Model</option>
<option value="b2b">B2B</option>
<option value="b2c">B2C</option>
<option value="b2b2c">B2B2C</option>
<option value="marketplace">Marketplace</option>
<option value="subscription">Subscription</option>
<option value="freemium">Freemium</option>
<option value="transaction">Transaction-based</option>
</select>
</div>
<div class="form-group">
<label for="timeline">Launch Timeline</label>
<select id="timeline">
<option value="">Select Timeline</option>
<option value="immediate">0-3 months</option>
<option value="short">3-6 months</option>
<option value="medium">6-12 months</option>
<option value="long">12+ months</option>
</select>
</div>
</div>
</div>
</div>

<div class="loading" id="loading">
<div class="spinner"></div>
<div id="loadingText">
<h3 style="color: white; margin-bottom: 20px;">AI Conducting Advanced Market Analysis</h3>
<div class="live-indicator">LIVE ANALYSIS</div>
<div class="analysis-progress" id="progressSteps">
<div class="progress-step" id="step1">Scanning global market trends and news...</div>
<div class="progress-step" id="step2">Analyzing competitive landscape and funding data...</div>
<div class="progress-step" id="step3">Evaluating market opportunities and gaps...</div>
<div class="progress-step" id="step4">Assessing growth potential and risks...</div>
<div class="progress-step" id="step5">Generating future market predictions...</div>
<div class="progress-step" id="step6">Creating AI-powered strategic recommendations...</div>
</div>
</div>
</div>

<div class="results-container" id="results" style="display: none;">
<div class="results-header">
<h2>Comprehensive Market Intelligence Report</h2>
<div class="live-indicator">REAL-TIME DATA</div>
</div>

<div class="results-grid">
<div class="result-card">
<h3>Executive Market Overview</h3>
<div class="metric-grid" id="overview-metrics"></div>
<div id="overview-content"></div>
<div class="web-sources" id="overview-sources"></div>
<div class="ai-insight">
<strong>AI Executive Assessment:</strong>
<div id="ai-overview"></div>
</div>
</div>

<div class="result-card">
<h3>Live Market Trends & Dynamics</h3>
<div id="trends-content"></div>
<div class="chart-container">
<canvas id="trendsChart"></canvas>
</div>
<div class="web-sources" id="trends-sources"></div>
<div class="ai-insight">
<strong>AI Trend Analysis:</strong>
<div id="trends-ai-insight"></div>
</div>
</div>

<div class="result-card">
<h3>Strategic Budget & Resource Analysis</h3>
<div class="budget-selector">
<div class="budget-card" onclick="selectBudget('low')">
<h4>Lean Launch</h4>
<p><strong>$5K - $50K</strong></p>
<small>Bootstrap approach</small>
</div>
<div class="budget-card" onclick="selectBudget('medium')">
<h4>Growth Accelerator</h4>
<p><strong>$50K - $500K</strong></p>
<small>Scale-focused strategy</small>
</div>
<div class="budget-card" onclick="selectBudget('high')">
<h4>Enterprise Scale</h4>
<p><strong>$500K+</strong></p>
<small>Rapid market capture</small>
</div>
</div>
<div id="budget-recommendations"></div>
<div class="ai-insight">
<strong>AI Budget Optimization:</strong>
<div id="budget-ai-insight"></div>
</div>
</div>

<div class="result-card">
<h3>Live Competition Intelligence</h3>
<div id="competition-content"></div>
<div class="chart-container">
<canvas id="competitionChart"></canvas>
</div>
<div class="web-sources" id="competition-sources"></div>
<div class="ai-insight">
<strong>AI Competitive Analysis:</strong>
<div id="competition-ai-insight"></div>
</div>
</div>

<div class="result-card">
<h3>AI-Powered Opportunity Assessment</h3>
<div id="rating-content">
<div class="rating-display">
<span><strong>Market Timing</strong></span>
<div class="stars" id="timing-rating"></div>
<span id="timing-score"></span>
<div class="trend-indicator" id="timing-trend"></div>
</div>
<div class="rating-display">
<span><strong>Competition Intensity</strong></span>
<div class="stars" id="competition-rating"></div>
<span id="competition-score"></span>
<div class="trend-indicator" id="competition-trend"></div>
</div>
<div class="rating-display">
<span><strong>Growth Potential</strong></span>
<div class="stars" id="future-rating"></div>
<span id="future-score"></span>
<div class="trend-indicator" id="future-trend"></div>
</div>
<div class="rating-display">
<span><strong>Investment Risk</strong></span>
<div class="stars" id="risk-rating"></div>
<span id="risk-score"></span>
<div class="trend-indicator" id="risk-trend"></div>
</div>
</div>
<div class="ai-insight">
<strong>AI Risk-Reward Analysis:</strong>
<div id="risk-reward-analysis"></div>
</div>
</div>

<div class="result-card">
<h3>Strategic Market Opportunities</h3>
<div id="capitalize-content"></div>
<div class="timeline" id="timeline"></div>
<div class="web-sources" id="opportunities-sources"></div>
<div class="ai-insight">
<strong>AI Opportunity Mapping:</strong>
<div id="opportunities-ai-insight"></div>
</div>
</div>

<div class="result-card">
<h3>AI-Generated Strategic Roadmap</h3>
<div id="actionplan-content"></div>
<div class="ai-insight">
<strong>AI Strategic Recommendations:</strong>
<div id="strategic-recommendations"></div>
</div>
</div>

<div class="result-card">
<h3>Market Sentiment & Future Outlook</h3>
<div id="sentiment-content"></div>
<div class="chart-container">
<canvas id="sentimentChart"></canvas>
</div>
<div class="web-sources" id="sentiment-sources"></div>
<div class="ai-insight">
<strong>AI Future Predictions:</strong>
<div id="sentiment-ai-insight"></div>
</div>
</div>

<div class="result-card">
<h3>AI Financial Projections</h3>
<div id="financial-content"></div>
<div class="chart-container">
<canvas id="financialChart"></canvas>
</div>
<div class="ai-insight">
<strong>AI Financial Modeling:</strong>
<div id="financial-ai-insight"></div>
</div>
</div>

<!-- NEW CARD FOR RAW EXTERNAL API OUTPUT -->
<div class="result-card" id="raw-api-output-card" style="display:none;">
    <h3>Raw External AI Output</h3>
    <pre id="rawApiOutput" style="white-space: pre-wrap; word-wrap: break-word; font-size: 0.9em; background-color: #f0f0f0; padding: 15px; border-radius: 8px; color: #333;"></pre>
    <div class="ai-insight" style="background: linear-gradient(135deg, #ffc107 0%, #ff8a00 100%);">
        <strong>Note:</strong> This is the raw text output from the external API. The comprehensive report above is generated by our platform's internal simulation for detailed analysis.
    </div>
</div>
</div>
</div>

<div id="error-container"></div>
</div>
</div>

<script>
const EXTERNAL_API_URL = "https://startupinsight-backend.x11cr24.repl.co/generate"; // Define the external API URL

let selectedBudget = null;
let analysisData = {};
let webSearchResults = {};
let isAnalyzing = false;

// Function to display error messages to the user
function showError(message) {
    const errorContainer = document.getElementById('error-container');
    errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
}

// Function to simulate web search and data generation
async function performWebSearch(query, type = 'general') {
    // Simulate network delay
    await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 2500));

    // Base search results for different query types
    const baseResults = {
        general: [
            { title: `${query} - Market Analysis Report 2024`, url: `https://example.com/market-analysis-${Math.random().toFixed(4)}`, snippet: `Comprehensive market analysis for ${query} industry.` },
            { title: `${query} Industry Trends & Forecasts`, url: `https://example.com/trends-${Math.random().toFixed(4)}`, snippet: `Latest trends and future predictions for ${query}.` },
            { title: `${query} Investment & Funding Analysis`, url: `https://example.com/funding-${Math.random().toFixed(4)}`, snippet: `Investment landscape and funding opportunities in ${query}.` }
        ],
        competition: [
            { title: `Top ${query} Companies 2024`, url: `https://example.com/companies-${Math.random().toFixed(4)}`, snippet: `Leading companies and market share analysis in ${query}.` },
            { title: `${query} Competitive Landscape`, url: `https://example.com/competitive-${Math.random().toFixed(4)}`, snippet: `Detailed competitive analysis and positioning for ${query}.` },
            { title: `${query} Market Leaders Report`, url: `https://example.com/leaders-${Math.random().toFixed(4)}`, snippet: `Analysis of market leaders and their strategies in ${query}.` }
        ],
        trends: [
            { title: `${query} Emerging Trends 2024`, url: `https://example.com/emerging-${Math.random().toFixed(4)}`, snippet: `Latest emerging trends and innovations in ${query}.` },
            { title: `${query} Future Outlook Report`, url: `https://example.com/future-${Math.random().toFixed(4)}`, snippet: `Long-term forecasts and predictions for ${query}.` },
            { title: `${query} Market Dynamics`, url: `https://example.com/dynamics-${Math.random().toFixed(4)}`, snippet: `Current market dynamics and forces affecting ${query}.` }
        ]
    };

    // Return simulated data based on the type of search
    return {
        results: baseResults[type] || baseResults.general,
        trends: generateAdvancedTrendsData(),
        marketData: generateAdvancedMarketData(),
        sentiment: generateAdvancedSentimentData(),
        competition: generateCompetitionData(),
        financial: generateFinancialProjections()
    };
}

// Generates simulated advanced trend data
function generateAdvancedTrendsData() {
    const trendTypes = ['Exponential Growth', 'Steady Growth', 'Volatile', 'Declining', 'Emerging'];
    const trend = trendTypes[Math.floor(Math.random() * trendTypes.length)];
    return {
        direction: trend,
        percentage: Math.floor(Math.random() * 40) + 10, // 10-50%
        timeframe: ['3 months', '6 months', '1 year', '2 years'][Math.floor(Math.random() * 4)],
        confidence: Math.floor(Math.random() * 30) + 70, // 70-100%
        drivers: ['Technology advancement', 'Consumer demand shifts', 'Regulatory changes', 'Market consolidation', 'Supply chain innovation']
    };
}

// Generates simulated advanced market data
function generateAdvancedMarketData() {
    return {
        marketSize: (Math.random() * 200 + 20).toFixed(1), // $20B - $220B
        growthRate: (Math.random() * 25 + 5).toFixed(1), // 5-30%
        marketMaturity: ['Emerging', 'Growth', 'Mature', 'Declining'][Math.floor(Math.random() * 4)],
        keyDrivers: ['Digital transformation', 'Consumer behavior shifts', 'Regulatory environment', 'Global connectivity'],
        barriers: ['High competition', 'Regulatory hurdles', 'Technical complexity', 'Capital intensity'],
        opportunities: Math.floor(Math.random() * 10) + 5 // 5-14 opportunities
    };
}

// Generates simulated advanced market sentiment data
function generateAdvancedSentimentData() {
    const sentiments = ['Very Positive', 'Positive', 'Neutral', 'Negative', 'Very Negative'];
    return {
        overall: sentiments[Math.floor(Math.random() * sentiments.length)],
        score: Math.random() * 100, // 0-100
        sources: Math.floor(Math.random() * 2000) + 500, // 500-2500 sources
        socialMentions: Math.floor(Math.random() * 50000) + 10000, // 10000-60000 mentions
        newsArticles: Math.floor(Math.random() * 500) + 100 // 100-600 articles
    };
}

// Generates simulated competition data
function generateCompetitionData() {
    const competitors = [
        { name: 'Market Leader Alpha', share: 25 + Math.floor(Math.random() * 10), funding: 500 + Math.floor(Math.random() * 500), stage: 'Public', description: 'Dominant player with extensive market reach and established customer base.' },
        { name: 'Growing Player Beta', share: 15 + Math.floor(Math.random() * 8), funding: 150 + Math.floor(Math.random() * 100), stage: 'Series C', description: 'Rapidly expanding with recent large funding rounds, strong in specific niches.' },
        { name: 'Disruptor Gamma', share: 8 + Math.floor(Math.random() * 5), funding: 50 + Math.floor(Math.random() * 50), stage: 'Series B', description: 'Innovative startup challenging established norms with a unique tech approach.' },
        { name: 'Emerging Delta', share: 3 + Math.floor(Math.random() * 4), funding: 10 + Math.floor(Math.random() * 40), stage: 'Series A', description: 'New entrant with a highly focused value proposition or early-stage breakthrough.' },
        { name: 'Others', share: 100 - (25 + Math.floor(Math.random() * 10) + 15 + Math.floor(Math.random() * 8) + 8 + Math.floor(Math.random() * 5) + 3 + Math.floor(Math.random() * 4)), funding: 0, stage: 'Various', description: 'Numerous smaller players and niche solutions, contributing to market fragmentation.' }
    ];
    // Ensure total share is 100%
    const totalKnownShare = competitors.slice(0, 4).reduce((sum, c) => sum + c.share, 0);
    competitors[4].share = Math.max(0, 100 - totalKnownShare);
    return competitors;
}

// Generates simulated financial projections
function generateFinancialProjections() {
    const years = ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'];
    const revenue = years.map((year, index) => {
        const baseRevenue = Math.floor(Math.random() * 500000 * (index + 1)) + 100000; // 100k to 2.5M
        const expenses = Math.floor(baseRevenue * (0.6 + Math.random() * 0.2)); // 60-80% of revenue
        const profit = baseRevenue - expenses;
        return { year, revenue: baseRevenue, expenses, profit };
    });
    return revenue;
}

// Main function to trigger the analysis
async function analyzeStartup() {
    if (isAnalyzing) return; // Prevent multiple analyses

    const idea = document.getElementById('startupIdea').value.trim();
    const industry = document.getElementById('industry').value;
    const stage = document.getElementById('stage').value;
    const targetMarket = document.getElementById('targetMarket').value;
    const geography = document.getElementById('geography').value;
    const businessModel = document.getElementById('businessModel').value;
    const timeline = document.getElementById('timeline').value;

    // Basic validation
    if (!idea || !industry || !stage) {
        showError('Please provide a detailed description of your startup idea, select an industry, and a stage to begin comprehensive analysis.');
        return;
    }

    isAnalyzing = true;
    const btn = document.getElementById('analyzeBtn');
    btn.disabled = true;
    btn.innerHTML = 'Analyzing...';

    // Show loading state and hide results/errors
    document.getElementById('loading').classList.add('active');
    document.getElementById('results').style.display = 'none';
    document.getElementById('error-container').innerHTML = '';

    // Reset progress steps
    const steps = document.querySelectorAll('.progress-step');
    steps.forEach(step => {
        step.classList.remove('active', 'completed');
        // Reset the content in case it was modified by the checkmark
        step.innerHTML = step.innerHTML.replace('✔ ', '');
    });

    try {
        // --- NEW: Call the external API first and display its raw output ---
        const promptText = document.getElementById('startupIdea').value.trim();
        const rawApiOutputElem = document.getElementById('rawApiOutput');
        const rawApiOutputCard = document.getElementById('raw-api-output-card');
        rawApiOutputElem.textContent = "Fetching raw AI output from external service...";
        rawApiOutputCard.style.display = 'block'; // Show the card

        try {
            const response = await fetch(EXTERNAL_API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt: promptText }),
            });
            if (!response.ok) throw new Error("Network response was not ok from external API.");
            const data = await response.json();
            rawApiOutputElem.textContent = data.output || "No output received from external API.";
        } catch (apiError) {
            rawApiOutputElem.textContent = "Error fetching raw AI output: " + apiError.message;
            console.error("External API fetch error:", apiError);
        }
        // --- END NEW API CALL ---

        // Continue with existing simulated analysis for the rich report
        await conductAdvancedAnalysis(idea, industry, stage, targetMarket, geography, businessModel, timeline);

        document.getElementById('loading').classList.remove('active');
        document.getElementById('results').style.display = 'block';

    } catch (error) {
        console.error('Analysis failed:', error);
        showError(`Advanced analysis failed: ${error.message || 'An unknown error occurred.'}`);
        document.getElementById('loading').classList.remove('active');
    } finally {
        isAnalyzing = false;
        btn.disabled = false;
        btn.innerHTML = 'AI Analyze';
    }
}

// Orchestrates the multi-step analysis process
async function conductAdvancedAnalysis(idea, industry, stage, targetMarket, geography, businessModel, timeline) {
    const steps = ['step1', 'step2', 'step3', 'step4', 'step5', 'step6'];

    // Step 1: Market trends analysis
    updateProgressStep(0, true);
    const marketQuery = `${idea} ${industry} market trends ${new Date().getFullYear()}`;
    webSearchResults.market = await performWebSearch(marketQuery, 'trends');
    updateProgressStep(0, false, true); // Mark as completed

    // Step 2: Competition analysis
    updateProgressStep(1, true);
    const competitionQuery = `${idea} ${industry} competitors landscape analysis`;
    webSearchResults.competition = await performWebSearch(competitionQuery, 'competition');
    updateProgressStep(1, false, true);

    // Step 3: Market opportunities
    updateProgressStep(2, true);
    const opportunitiesQuery = `${idea} ${industry} market opportunities ${geography}`;
    webSearchResults.opportunities = await performWebSearch(opportunitiesQuery);
    updateProgressStep(2, false, true);

    // Step 4: Growth potential analysis
    updateProgressStep(3, true);
    const growthQuery = `${idea} ${industry} growth potential forecast`;
    webSearchResults.growth = await performWebSearch(growthQuery);
    updateProgressStep(3, false, true);

    // Step 5: Future predictions
    updateProgressStep(4, true);
    const futureQuery = `${idea} ${industry} future outlook predictions`;
    webSearchResults.future = await performWebSearch(futureQuery);
    updateProgressStep(4, false, true);

    // Step 6: AI analysis compilation
    updateProgressStep(5, true);
    analysisData = await generateAdvancedAIAnalysis(idea, industry, stage, targetMarket, geography, businessModel, timeline, webSearchResults);
    updateProgressStep(5, false, true);

    // Populate all sections with the generated data
    populateAllAdvancedSections();
}

// Updates the visual progress of the analysis steps
function updateProgressStep(stepIndex, isActive, isCompleted = false) {
    const stepId = `step${stepIndex + 1}`;
    const stepElement = document.getElementById(stepId);

    if (!stepElement) return; // Guard against missing elements

    stepElement.classList.remove('active', 'completed'); // Reset classes

    if (isCompleted) {
        stepElement.classList.add('completed');
        // Add a checkmark if not already present
        if (!stepElement.innerHTML.includes('✔')) {
            stepElement.innerHTML = '✔ ' + stepElement.innerHTML;
        }
    } else if (isActive) {
        stepElement.classList.add('active');
    }
}

// Generates the main AI analysis data based on simulated search results
async function generateAdvancedAIAnalysis(idea, industry, stage, targetMarket, geography, businessModel, timeline, searchResults) {
    // Simulate AI processing time
    await new Promise(resolve => setTimeout(resolve, 2000));

    // Determine ratings and trends based on simulated data
    const marketTimingScore = Math.floor(Math.random() * 3) + 3; // 3-5 stars
    const competitionIntensityScore = Math.floor(Math.random() * 3) + 1; // 1-3 stars (lower is better for intensity)
    const growthPotentialScore = Math.floor(Math.random() * 3) + 3; // 3-5 stars
    const investmentRiskScore = Math.floor(Math.random() * 3) + 1; // 1-3 stars (lower is better for risk)

    // Assign financial data to a local variable here to ensure it's defined before use
    const financialData = searchResults.market.financial;

    const marketTimingTrend = ['trend-up', 'trend-stable', 'trend-down'][Math.floor(Math.random() * 3)];
    const competitionTrend = ['trend-up', 'trend-stable', 'trend-down'][Math.floor(Math.random() * 3)]; // Up means more intense
    const growthTrend = ['trend-up', 'trend-stable', 'trend-down'][Math.floor(Math.random() * 3)];
    const riskTrend = ['trend-up', 'trend-stable', 'trend-down'][Math.floor(Math.random() * 3)]; // Up means more risk

    // Calculate overall AI score (simple average for demonstration)
    const overallScore = ((marketTimingScore + (6 - competitionIntensityScore) + growthPotentialScore + (6 - investmentRiskScore)) / 4 * 20).toFixed(0);

    return {
        idea, industry, stage, targetMarket, geography, businessModel, timeline,
        marketTiming: marketTimingScore,
        competitionLevel: competitionIntensityScore,
        futureRating: growthPotentialScore,
        riskRating: investmentRiskScore,
        overallScore: overallScore,
        marketData: searchResults.market.marketData,
        trends: searchResults.market.trends,
        sentiment: searchResults.future.sentiment,
        competition: searchResults.competition.competition,
        financial: financialData, // Use the local variable here
        // AI-generated text for different sections - ENHANCED FOR DETAIL AND ACCURACY
        aiOverview: `Based on a real-time scan of the global ${industry} market, your concept for a startup in the ${targetMarket} segment exhibits characteristics of an ${searchResults.market.marketData.marketMaturity.toLowerCase()} market. The current market size is estimated at a substantial **$${searchResults.market.marketData.marketSize} Billion**, with a robust projected annual growth rate of **${searchResults.market.marketData.growthRate}%**. This growth is primarily fueled by key drivers such as ${searchResults.market.marketData.keyDrivers.slice(0, 2).join(' and ')}. However, potential barriers like ${searchResults.market.marketData.barriers[0]} will require strategic navigation.`,
        trendsAiInsight: `Current market trends indicate a strong **${searchResults.market.trends.direction}** trajectory within the ${industry} sector, with a projected **${searchResults.market.trends.percentage}% increase** in market activity over the next **${searchResults.market.trends.timeframe}**. This upward trend is confidently predicted with a **${searchResults.market.trends.confidence}% certainty**, largely driven by advancements in **${searchResults.market.trends.drivers[0]}** and shifting **${searchResults.market.trends.drivers[1]}**. This suggests a fertile ground for new entrants.`,
        budgetAiInsight: (budget) => {
            let insight = `For a **${budget.toUpperCase()}** budget, strategic allocation of resources is paramount to maximize impact.`;
            if (budget === 'low') insight += ` We recommend prioritizing **core MVP development** and establishing direct, iterative **customer feedback loops**. Leverage cost-effective strategies such as **open-source technologies** for infrastructure and **lean digital marketing tactics** (e.g., organic social media, community building) to achieve initial traction with minimal burn. Focus on proving concept viability.`;
            if (budget === 'medium') insight += ` This budget allows for more aggressive **targeted marketing campaigns** (e.g., PPC, SEO optimization) and the strategic **expansion of your core team** with essential hires in product and sales. Invest in scalable infrastructure and robust analytics to track **user acquisition and retention metrics**. The focus should be on accelerating growth and preparing for significant funding rounds.`;
            if (budget === 'high') insight += ` With a **${budget.toUpperCase()}** budget, pursue **aggressive market penetration strategies** and comprehensive **brand building**. This enables substantial investment in **research & development** for continuous product innovation and building out full-fledged teams across all departments. Explore strategic partnerships and potential M&A opportunities to rapidly capture market share and establish a dominant position.`;
            return insight;
        },
        competitionAiInsight: `The competitive landscape in the ${industry} market is currently **${competitionIntensityScore < 3 ? 'moderately intense' : 'highly competitive'}**. The market leader, **${searchResults.competition.competition[0].name}**, commands a significant **${searchResults.competition.competition[0].share}% market share** with substantial funding of **$${searchResults.competition.competition[0].funding}M**. However, emerging disruptors like **${searchResults.competition.competition[2].name}** (with $${searchResults.competition.competition[2].funding}M in funding) are introducing innovative solutions. Your startup can find opportunities by focusing on underserved niches or leveraging a truly differentiated value proposition.`,
        riskRewardAnalysis: `Your startup's market timing is rated **${marketTimingScore}/5**, indicating **${marketTimingScore >= 4 ? 'favorable' : 'moderate'}** conditions for entry. Competition intensity stands at **${analysisData.competitionLevel}/5**, suggesting **${analysisData.competitionLevel <= 2 ? 'manageable' : 'significant'}** competitive pressures that require a robust differentiation strategy. The growth potential is strong at **${growthPotentialScore}/5**, highlighting a promising future. However, investment risk is **${investmentRiskScore}/5**, which implies careful mitigation strategies are essential to secure funding and ensure long-term viability.`,
        opportunitiesAiInsight: `Significant strategic opportunities exist in **${geography}** for ${industry} solutions, specifically addressing **${searchResults.market.marketData.opportunities} identified market gaps**. A key area to capitalize on is **${searchResults.market.marketData.keyDrivers[0]}**, which is driving substantial demand. Consider leveraging emerging technologies like **AI/ML** to create a unique value proposition that disrupts existing solutions and captures market share. Early adoption in specific sub-segments of ${analysisData.targetMarket} could yield rapid returns.`,
        strategicRecommendations: `Your strategic roadmap should prioritize the following key actions: 1) **Deep Market Validation:** Conduct extensive validation with early adopters to refine your unique value proposition. 2) **Lean & Scalable MVP:** Develop a Minimum Viable Product that is both robust and designed for future scalability. 3) **Targeted Seed Funding:** Focus on securing seed investment from strategic angels or VCs aligned with your industry. 4) **Digital Presence & Community:** Build a strong online presence and foster an engaged community around your solution. 5) **Continuous Adaptation:** Implement agile methodologies to continuously monitor market shifts, competitive actions, and adapt your strategy accordingly for sustained growth.`,
        sentimentAiInsight: `Overall market sentiment for the ${industry} sector is currently **${searchResults.future.sentiment.overall.toLowerCase()}** with a strong sentiment score of **${searchResults.future.sentiment.score.toFixed(1)}/100**. This positive outlook is supported by a high volume of analyzed sources (**${searchResults.future.sentiment.sources.toLocaleString()}**), significant social media mentions (**${searchResults.future.sentiment.socialMentions.toLocaleString()}**), and a notable presence in recent news articles (**${searchResults.future.sentiment.newsArticles.toLocaleString()}**). This indicates a receptive market environment for new innovations.`,
        financialAiInsight: `Initial financial projections indicate a positive growth trajectory over the next 5 years, with an estimated **${(financialData[4].profit / financialData[0].profit * 100).toFixed(0)}% increase in profitability** from Year 1 to Year 5. A critical pinpoint for Year 1 is to meticulously manage operational expenses to maximize early profitability and cash flow. By Year 3, explore diversified revenue streams and potential strategic partnerships to ensure sustained growth and resilience against market fluctuations. Your projected revenue in Year 5 is approximately **$${financialData[4].revenue.toLocaleString()}**.`
    };
}

// Populates all result sections with the generated analysis data
function populateAllAdvancedSections() {
    console.log('Populating all advanced sections...');
    populateExecutiveOverview();
    populateMarketTrends();
    populateBudgetAnalysis(); // Renamed for clarity
    populateCompetitionIntelligence();
    populateOpportunityAssessment();
    populateStrategicOpportunities();
    populateActionPlan();
    populateMarketSentiment();
    populateFinancialProjections();

    // Set a default budget selection after results are loaded
    selectBudget('medium');
    console.log('All advanced sections populated.');
}

// Populates the Executive Market Overview section
function populateExecutiveOverview() {
    console.log('Populating Executive Overview...');
    const metrics = document.getElementById('overview-metrics');
    const content = document.getElementById('overview-content');
    const sources = document.getElementById('overview-sources');
    const aiOverview = document.getElementById('ai-overview');

    const data = analysisData.marketData;

    metrics.innerHTML = `
        <div class="metric-card">
            <span class="metric-value">$${data.marketSize}B</span>
            <div class="metric-label">Market Size</div>
        </div>
        <div class="metric-card">
            <span class="metric-value">${data.growthRate}%</span>
            <div class="metric-label">Growth Rate</div>
        </div>
        <div class="metric-card">
            <span class="metric-value">${analysisData.overallScore}/100</span>
            <div class="metric-label">AI Score</div>
        </div>
        <div class="metric-card">
            <span class="metric-value">${data.opportunities}</span>
            <div class="metric-label">Opportunities</div>
        </div>
    `;

    content.innerHTML = `
        <p><strong>Industry:</strong> ${analysisData.industry}</p>
        <p><strong>Market Stage:</strong> ${data.marketMaturity}</p>
        <p><strong>Business Model:</strong> ${analysisData.businessModel || 'Not specified'}</p>
        <p><strong>Target Geography:</strong> ${analysisData.geography || 'Global'}</p>
        <p><strong>Analysis Date:</strong> ${new Date().toLocaleDateString()} (Real-time)</p>
    `;

    sources.innerHTML = `
        <h4>Live Data Sources</h4>
        <div class="source-links">
            ${webSearchResults.market.results.map(result =>
                `<a href="${result.url}" class="source-link" target="_blank">${result.title}</a>`
            ).join('')}
        </div>
    `;

    aiOverview.innerHTML = `<p>${analysisData.aiOverview}</p>`;
    console.log('Executive Overview populated.');
}

// Populates the Live Market Trends & Dynamics section
let trendsChartInstance = null; // To store Chart.js instance

function populateMarketTrends() {
    console.log('Populating Market Trends...');
    const trendsContent = document.getElementById('trends-content');
    const trendsSources = document.getElementById('trends-sources');
    const trendsAiInsight = document.getElementById('trends-ai-insight');
    const trendsChartCanvas = document.getElementById('trendsChart');

    const trendsData = analysisData.trends;

    trendsContent.innerHTML = `
        <p><strong>Dominant Trend:</strong> <span class="trend-indicator ${getTrendClass(trendsData.direction)}">${trendsData.direction}</span></p>
        <p><strong>Projected Growth:</strong> ${trendsData.percentage}% over ${trendsData.timeframe}</p>
        <p><strong>Confidence Level:</strong> ${trendsData.confidence}%</p>
        <p><strong>Primary Drivers:</strong> ${trendsData.drivers.join(', ')}</p>
    `;

    trendsSources.innerHTML = `
        <h4>Live Data Sources</h4>
        <div class="source-links">
            ${webSearchResults.market.results.map(result =>
                `<a href="${result.url}" class="source-link" target="_blank">${result.title}</a>`
            ).join('')}
        </div>
    `;

    trendsAiInsight.innerHTML = `<p>${analysisData.trendsAiInsight}</p>`;

    // Chart for Trends (simple line chart)
    if (trendsChartInstance) {
        trendsChartInstance.destroy(); // Destroy existing chart
    }
    trendsChartInstance = new Chart(trendsChartCanvas, {
        type: 'line',
        data: {
            labels: ['Q1', 'Q2', 'Q3', 'Q4', 'Q1+', 'Q2+'], // Example time labels
            datasets: [{
                label: 'Market Growth Index',
                data: [
                    Math.random() * 50 + 50,
                    Math.random() * 50 + 50,
                    Math.random() * 50 + 50,
                    Math.random() * 50 + 50,
                    Math.random() * 50 + 50,
                    Math.random() * 50 + 50
                ].map((val, i) => val + i * (trendsData.percentage / 10)), // Simulate growth
                borderColor: '#00f2fe',
                backgroundColor: 'rgba(0, 242, 254, 0.2)',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Market Growth Trend Over Time',
                    color: '#333'
                },
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Index Value'
                    }
                }
            }
        }
    });
    console.log('Market Trends populated.');
}

// Populates the Strategic Budget & Resource Analysis section
function populateBudgetAnalysis() {
    console.log('Populating Budget Analysis...');
    // The budget selector is static HTML, only the recommendations change
    const budgetAiInsight = document.getElementById('budget-ai-insight');
    // Initial AI insight for budget section (will be updated on selection)
    budgetAiInsight.innerHTML = `<p>Select a budget tier to receive AI-powered recommendations tailored to your funding strategy.</p>`;
    console.log('Budget Analysis populated.');
}

// Handles budget selection and updates recommendations
function selectBudget(budgetType) {
    console.log(`Budget selected: ${budgetType}`);
    selectedBudget = budgetType;
    const budgetCards = document.querySelectorAll('.budget-card');
    budgetCards.forEach(card => card.classList.remove('selected'));
    document.querySelector(`.budget-card[onclick="selectBudget('${budgetType}')"]`).classList.add('selected');

    const budgetRecommendations = document.getElementById('budget-recommendations');
    const budgetAiInsight = document.getElementById('budget-ai-insight');

    let recommendations = '';
    switch (budgetType) {
        case 'low':
            recommendations = `
                <h4>Lean Launch Recommendations:</h4>
                <ul>
                    <li>Focus on a Minimum Viable Product (MVP) with core features.</li>
                    <li>Utilize free or low-cost marketing channels (social media, content marketing).</li>
                    <li>Prioritize direct customer interviews for validation.</li>
                    <li>Outsource non-core activities to freelancers.</li>
                    <li>Seek pre-seed or angel investment for initial traction.</li>
                </ul>
            `;
            break;
        case 'medium':
            recommendations = `
                <h4>Growth Accelerator Recommendations:</h4>
                <ul>
                    <li>Invest in targeted digital marketing campaigns (PPC, SEO).</li>
                    <li>Expand core team with essential hires (e.g., sales, marketing).</li>
                    <li>Develop scalable infrastructure and robust analytics.</li>
                    <li>Focus on user acquisition metrics and retention strategies.</li>
                    <li>Prepare for Seed or Series A funding rounds.</li>
                </ul>
            `;
            break;
        case 'high':
            recommendations = `
                <h4>Enterprise Scale Recommendations:</h4>
                <ul>
                    <li>Aggressive market penetration strategies and brand building.</li>
                    <li>Build out full-fledged teams across all departments.</li>
                    <li>Invest heavily in R&D and product innovation.</li>
                    <li>Explore strategic partnerships, mergers, or acquisitions.</li>
                    <li>Target Series B+ funding for rapid global expansion.</li>
                </ul>
            `;
            break;
    }
    budgetRecommendations.innerHTML = recommendations;
    // Ensure analysisData.budgetAiInsight is a function before calling it
    if (typeof analysisData.budgetAiInsight === 'function') {
        budgetAiInsight.innerHTML = `<p>${analysisData.budgetAiInsight(budgetType)}</p>`;
    } else {
        budgetAiInsight.innerHTML = `<p>AI budget insight not available.</p>`;
    }
}

// Populates the Live Competition Intelligence section
let competitionChartInstance = null; // To store Chart.js instance

function populateCompetitionIntelligence() {
    console.log('Populating Competition Intelligence...');
    const competitionContent = document.getElementById('competition-content');
    const competitionSources = document.getElementById('competition-sources');
    const competitionAiInsight = document.getElementById('competition-ai-insight');
    const competitionChartCanvas = document.getElementById('competitionChart');

    const competitors = analysisData.competition;

    competitionContent.innerHTML = `
        <h4>Key Competitors:</h4>
        ${competitors.map(comp => `
            <div class="competition-item">
                <strong>${comp.name}</strong> (${comp.stage})<br>
                Market Share: ${comp.share}% | Funding: $${comp.funding}M<br>
                <small>${comp.description}</small>
            </div>
        `).join('')}
    `;

    competitionSources.innerHTML = `
        <h4>Live Data Sources</h4>
        <div class="source-links">
            ${webSearchResults.competition.results.map(result =>
                `<a href="${result.url}" class="source-link" target="_blank">${result.title}</a>`
            ).join('')}
        </div>
    `;

    competitionAiInsight.innerHTML = `<p>${analysisData.competitionAiInsight}</p>`;

    // Chart for Competition (Doughnut chart for market share)
    if (competitionChartInstance) {
        competitionChartInstance.destroy();
    }
    competitionChartInstance = new Chart(competitionChartCanvas, {
        type: 'doughnut',
        data: {
            labels: competitors.map(c => c.name),
            datasets: [{
                data: competitors.map(c => c.share),
                backgroundColor: [
                    '#667eea', '#4facfe', '#00f2fe', '#38ef7d', '#e2e8f0'
                ],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Market Share Distribution',
                    color: '#333'
                },
                legend: {
                    position: 'right',
                    labels: {
                        color: '#333'
                    }
                }
            }
        }
    });
    console.log('Competition Intelligence populated.');
}

// Populates the AI-Powered Opportunity Assessment section
function populateOpportunityAssessment() {
    console.log('Populating Opportunity Assessment...');
    const timingRating = document.getElementById('timing-rating');
    const timingScore = document.getElementById('timing-score');
    const timingTrend = document.getElementById('timing-trend');

    const competitionRating = document.getElementById('competition-rating');
    const competitionScore = document.getElementById('competition-score');
    const competitionTrend = document.getElementById('competition-trend');

    const futureRating = document.getElementById('future-rating');
    const futureScore = document.getElementById('future-score');
    const futureTrend = document.getElementById('future-trend');

    const riskRating = document.getElementById('risk-rating');
    const riskScore = document.getElementById('risk-score');
    const riskTrend = document.getElementById('risk-trend');

    const riskRewardAnalysis = document.getElementById('risk-reward-analysis');

    // Market Timing
    renderStars(timingRating, analysisData.marketTiming);
    timingScore.textContent = `${analysisData.marketTiming}/5`;
    timingTrend.className = `trend-indicator ${getTrendClassForRating(analysisData.marketTiming)}`;
    timingTrend.textContent = getTrendTextForRating(analysisData.marketTiming);

    // Competition Intensity (lower stars = less intense = better)
    renderStars(competitionRating, analysisData.competitionLevel);
    competitionScore.textContent = `${analysisData.competitionLevel}/5`;
    competitionTrend.className = `trend-indicator ${getTrendClassForRating(6 - analysisData.competitionLevel)}`; // Invert for display
    competitionTrend.textContent = getTrendTextForRating(6 - analysisData.competitionLevel);

    // Growth Potential
    renderStars(futureRating, analysisData.futureRating);
    futureScore.textContent = `${analysisData.futureRating}/5`;
    futureTrend.className = `trend-indicator ${getTrendClassForRating(analysisData.futureRating)}`;
    futureTrend.textContent = getTrendTextForRating(analysisData.futureRating);

    // Investment Risk (lower stars = less risk = better)
    renderStars(riskRating, analysisData.riskRating);
    riskScore.textContent = `${analysisData.riskRating}/5`;
    riskTrend.className = `trend-indicator ${getTrendClassForRating(6 - analysisData.riskRating)}`; // Invert for display
    riskTrend.textContent = getTrendTextForRating(6 - analysisData.riskRating);

    riskRewardAnalysis.innerHTML = `<p>${analysisData.riskRewardAnalysis}</p>`;
    console.log('Opportunity Assessment populated.');
}

// Helper function to render star ratings
function renderStars(element, score) {
    element.innerHTML = '';
    for (let i = 1; i <= 5; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        if (i > score) {
            star.classList.add('empty');
        }
        element.appendChild(star);
    }
}

// Helper function to get trend class based on score (higher score = better trend)
function getTrendClass(direction) {
    if (direction.includes('Growth')) return 'trend-up';
    if (direction.includes('Stable') || direction.includes('Emerging')) return 'trend-stable';
    return 'trend-down';
}

// Helper function to get trend class based on score (higher score = better trend)
function getTrendClassForRating(score) {
    if (score >= 4) return 'trend-up';
    if (score === 3) return 'trend-stable';
    return 'trend-down';
}

// Helper function to get trend text based on score
function getTrendTextForRating(score) {
    if (score >= 4) return 'Positive';
    if (score === 3) return 'Stable';
    return 'Challenging';
}

// Populates the Strategic Market Opportunities section
function populateStrategicOpportunities() {
    console.log('Populating Strategic Opportunities...');
    const capitalizeContent = document.getElementById('capitalize-content');
    const timelineElement = document.getElementById('timeline');
    const opportunitiesSources = document.getElementById('opportunities-sources');
    const opportunitiesAiInsight = document.getElementById('opportunities-ai-insight');

    capitalizeContent.innerHTML = `
        <p>Based on our in-depth analysis, here are key strategic opportunities for your startup to capitalize on:</p>
        <ul>
            <li><strong>Niche Market Penetration:</strong> Identify and aggressively target underserved segments within your broader ${analysisData.targetMarket} market. This allows for concentrated efforts and strong initial market capture.</li>
            <li><strong>Technology Integration & Differentiation:</strong> Leverage cutting-edge technologies like AI/ML or blockchain to create a unique value proposition that significantly differentiates your offering from existing solutions.</li>
            <li><strong>Strategic Partnerships & Alliances:</strong> Formulate strategic alliances with established players or complementary businesses to accelerate market entry, gain credibility, and expand reach without extensive capital outlay.</li>
            <li><strong>Phased Geographic Expansion:</strong> Consider a phased expansion into high-growth regions within ${analysisData.geography}, starting with areas showing the highest early adoption potential and lowest competitive friction.</li>
            <li><strong>Innovation in Business Model:</strong> Explore novel and disruptive revenue models beyond traditional approaches (e.g., freemium, usage-based, platform-as-a-service) to unlock new customer segments and revenue streams.</li>
        </ul>
    `;

    // Simulate timeline events
    timelineElement.innerHTML = `
        <div class="timeline-item">
            <h4>Phase 1: Concept Validation & MVP (0-3 months)</h4>
            <p><strong>Objective:</strong> Validate core assumptions and build a Minimum Viable Product.
            <br><strong>Key Activities:</strong> Conduct extensive customer interviews (targeting 50+ potential users), develop a lean MVP with essential features, and establish initial analytics tracking. Focus on proving problem-solution fit.</p>
        </div>
        <div class="timeline-item">
            <h4>Phase 2: Product-Market Fit & Seed Funding (3-9 months)</h4>
            <p><strong>Objective:</strong> Achieve initial product-market fit and secure seed investment.
            <br><strong>Key Activities:</strong> Iterate on the MVP based on early user feedback, demonstrate clear value proposition, and begin actively seeking seed investment from aligned investors. Aim for key user engagement metrics.</p>
        </div>
        <div class="timeline-item">
            <h4>Phase 3: Growth & User Acquisition (9-18 months)</h4>
            <p><strong>Objective:</strong> Scale user acquisition and optimize growth channels.
            <br><strong>Key Activities:</strong> Implement targeted digital marketing campaigns, optimize conversion funnels, and expand user base. Prepare for Series A funding rounds based on demonstrated traction and growth metrics.</p>
        </div>
        <div class="timeline-item">
            <h4>Phase 4: Expansion & Diversification (18-36 months)</h4>
            <p><strong>Objective:</strong> Expand product offerings and explore new market segments.
            <br><strong>Key Activities:</strong> Develop new features or product lines, consider geographic expansion into new high-potential territories, and diversify revenue streams to build long-term resilience.</p>
        </div>
    `;

    opportunitiesSources.innerHTML = `
        <h4>Live Data Sources</h4>
        <div class="source-links">
            ${webSearchResults.opportunities.results.map(result =>
                `<a href="${result.url}" class="source-link" target="_blank">${result.title}</a>`
            ).join('')}
        </div>
    `;

    opportunitiesAiInsight.innerHTML = `<p>${analysisData.opportunitiesAiInsight}</p>`;
    console.log('Strategic Opportunities populated.');
}

// Populates the AI-Generated Strategic Roadmap section
function populateActionPlan() {
    console.log('Populating Action Plan...');
    const actionplanContent = document.getElementById('actionplan-content');
    const strategicRecommendations = document.getElementById('strategic-recommendations');

    actionplanContent.innerHTML = `
        <p>Our AI has generated a tailored strategic roadmap to guide your startup's journey, broken down by key phases:</p>
        <ul>
            <li><strong>Month 1-3: Foundation & Validation:</strong> Deep dive into customer needs and pain points. Define your core Minimum Viable Product (MVP) features. Set up initial analytics to track user behavior and engagement from day one.</li>
            <li><strong>Month 4-6: MVP Development & Iteration:</strong> Build and rigorously test your MVP. Conduct beta testing with early adopters to gather critical feedback. Focus on rapid iteration based on user insights.</li>
            <li><strong>Month 7-12: Launch & Initial Traction:</strong> Execute a soft launch. Refine your marketing messages based on early customer feedback. Focus intensely on acquiring your first 100-1000 users and demonstrating clear value.</li>
            <li><strong>Year 2: Scale & Optimization:</strong> Expand your feature set based on user demand and market gaps. Optimize your conversion funnels and explore new, cost-effective marketing channels to scale user acquisition.</li>
            <li><strong>Year 3+: Diversification & Growth:</strong> Strategically look into new product lines or services. Plan for geographic expansion into promising new markets. Explore strategic partnerships or even potential acquisitions to accelerate growth and market presence.</li>
        </ul>
    `;

    strategicRecommendations.innerHTML = `<p>${analysisData.strategicRecommendations}</p>`;
    console.log('Action Plan populated.');
}

// Populates the Market Sentiment & Future Outlook section
let sentimentChartInstance = null;

function populateMarketSentiment() {
    console.log('Populating Market Sentiment...');
    const sentimentContent = document.getElementById('sentiment-content');
    const sentimentSources = document.getElementById('sentiment-sources');
    const sentimentAiInsight = document.getElementById('sentiment-ai-insight');
    const sentimentChartCanvas = document.getElementById('sentimentChart');

    const sentimentData = analysisData.sentiment;

    sentimentContent.innerHTML = `
        <p><strong>Overall Market Sentiment:</strong> <span class="trend-indicator ${getSentimentClass(sentimentData.overall)}">${sentimentData.overall}</span></p>
        <p><strong>Sentiment Score:</strong> ${sentimentData.score.toFixed(1)}/100</p>
        <p><strong>Analyzed Sources:</strong> ${sentimentData.sources.toLocaleString()}</p>
        <p><strong>Social Media Mentions:</strong> ${sentimentData.socialMentions.toLocaleString()}</p>
        <p><strong>News Articles:</strong> ${sentimentData.newsArticles.toLocaleString()}</p>
    `;

    sentimentSources.innerHTML = `
        <h4>Live Data Sources</h4>
        <div class="source-links">
            ${webSearchResults.future.results.map(result =>
                `<a href="${result.url}" class="source-link" target="_blank">${result.title}</a>`
            ).join('')}
        </div>
    `;

    sentimentAiInsight.innerHTML = `<p>${analysisData.sentimentAiInsight}</p>`;

    // Chart for Sentiment (Bar chart)
    if (sentimentChartInstance) {
        sentimentChartInstance.destroy();
    }
    sentimentChartInstance = new Chart(sentimentChartCanvas, {
        type: 'bar',
        data: {
            labels: ['Positive', 'Neutral', 'Negative'],
            datasets: [{
                label: 'Sentiment Distribution',
                data: [
                    sentimentData.score * 0.6, // Simulate positive
                    sentimentData.score * 0.2, // Simulate neutral
                    100 - sentimentData.score // Simulate negative
                ],
                backgroundColor: [
                    'rgba(56, 239, 125, 0.8)', // Success green
                    'rgba(255, 193, 7, 0.8)',  // Warning yellow
                    'rgba(255, 65, 108, 0.8)'  // Danger red
                ],
                borderColor: [
                    '#38ef7d', '#ffc107', '#ff416c'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Market Sentiment Breakdown',
                    color: '#333'
                },
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Score / Percentage'
                    }
                }
            }
        }
    });
    console.log('Market Sentiment populated.');
}

// Helper function to get sentiment class
function getSentimentClass(sentiment) {
    if (sentiment.includes('Positive')) return 'trend-up';
    if (sentiment.includes('Neutral')) return 'trend-stable';
    return 'trend-down';
}

// Populates the AI Financial Projections section
let financialChartInstance = null;

function populateFinancialProjections() {
    console.log('Populating Financial Projections...');
    const financialContent = document.getElementById('financial-content');
    const financialAiInsight = document.getElementById('financial-ai-insight');
    const financialChartCanvas = document.getElementById('financialChart');

    const financialData = analysisData.financial; // Access financial data from analysisData

    financialContent.innerHTML = `
        <h4>Projected Financials (5 Years):</h4>
        <table style="width:100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr style="background-color:#f2f2f2;">
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Year</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">Revenue</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">Expenses</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">Profit</th>
                </tr>
            </thead>
            <tbody>
                ${financialData.map(data => `
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">${data.year}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">$${data.revenue.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">$${data.expenses.toLocaleString()}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: right; color: ${data.profit >= 0 ? '#11998e' : '#ff416c'}; font-weight: bold;">$${data.profit.toLocaleString()}</td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;

    financialAiInsight.innerHTML = `<p>${analysisData.financialAiInsight}</p>`;

    // Chart for Financial Projections (Bar chart for Revenue, Expenses, Profit)
    if (financialChartInstance) {
        financialChartInstance.destroy();
    }
    financialChartInstance = new Chart(financialChartCanvas, {
        type: 'bar',
        data: {
            labels: financialData.map(d => d.year),
            datasets: [
                {
                    label: 'Revenue',
                    data: financialData.map(d => d.revenue),
                    backgroundColor: 'rgba(102, 126, 234, 0.8)', // Primary gradient blue
                    borderColor: '#667eea',
                    borderWidth: 1
                },
                {
                    label: 'Expenses',
                    data: financialData.map(d => d.expenses),
                    backgroundColor: 'rgba(255, 193, 7, 0.8)', // Warning yellow
                    borderColor: '#ffc107',
                    borderWidth: 1
                },
                {
                    label: 'Profit',
                    data: financialData.map(d => d.profit),
                    backgroundColor: 'rgba(56, 239, 125, 0.8)', // Success green
                    borderColor: '#38ef7d',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Projected Financials Over 5 Years',
                    color: '#333'
                },
                legend: {
                    position: 'top',
                    labels: {
                        color: '#333'
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Amount ($)'
                    }
                }
            }
        }
    });
    console.log('Financial Projections populated.');
}

// Initial call to set up default budget selection on page load
document.addEventListener('DOMContentLoaded', () => {
    // This will be called after the initial populateAllAdvancedSections()
    // if the results are hidden. If you want a default selection visible
    // even before analysis, you'd call selectBudget('medium') here.
    // For now, it's called after analysis completes.
});

</script>
</body>
</html>
